<button id="start-btn">Speak</button>
<p id="user-command"></p>
<p id="assistant-response"></p>

<script>
const startBtn = document.getElementById("start-btn");
const userCommand = document.getElementById("user-command");
const assistantResponse = document.getElementById("assistant-response");

const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.lang = 'en-US';
recognition.interimResults = false;
recognition.maxAlternatives = 1;

startBtn.addEventListener("click", () => {
    recognition.start();
});

recognition.onresult = (event) => {
    const command = event.results[0][0].transcript;
    userCommand.textContent = `You said: ${command}`;
    sendCommandToBackend(command);
};

recognition.onerror = (event) => {
    console.error("Speech recognition error:", event.error);
};

async function sendCommandToBackend(commandText) {
    try {
        const response = await fetch("http://localhost:8000/voice/", {  // your FastAPI endpoint
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: commandText })
        });
        const data = await response.json();
        assistantResponse.textContent = `Assistant: ${data.response_text}`;
        speakResponse(data.response_text);
    } catch (err) {
        console.error("Error sending command:", err);
    }
}

function speakResponse(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    speechSynthesis.speak(utterance);
}
</script>
